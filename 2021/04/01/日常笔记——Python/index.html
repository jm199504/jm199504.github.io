<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Python function / package | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="概述：Python 函数及库笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="Python function &#x2F; package">
<meta property="og:url" content="http://example.com/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Python/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="概述：Python 函数及库笔记">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-04-01T02:53:58.727Z">
<meta property="article:modified_time" content="2021-04-01T05:44:57.399Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-日常笔记——Python" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Python/" class="article-date">
  <time class="dt-published" datetime="2021-04-01T02:53:58.727Z" itemprop="datePublished">2021-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Python function / package
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>概述：Python 函数及库笔记</p>
<span id="more"></span>

<p>[TOC]</p>
<h2 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">np.__version__</span><br></pre></td></tr></table></figure>

<h3 id="创建随机值及数组"><a href="#创建随机值及数组" class="headerlink" title="创建随机值及数组"></a>创建随机值及数组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机数：0-10</span></span><br><span class="line">a = np.random.randint(<span class="number">10</span>, size=(<span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一位数组</span></span><br><span class="line"><span class="built_in">print</span>(np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建二维数组</span></span><br><span class="line"><span class="built_in">print</span>(np.array([(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建全零数组</span></span><br><span class="line"><span class="built_in">print</span>(np.zeros((<span class="number">3</span>,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建全一数组</span></span><br><span class="line"><span class="built_in">print</span>(np.ones((<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一维等差数组(0 1 2 3 4)</span></span><br><span class="line"><span class="built_in">print</span>(np.arange(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建二维等差数列</span></span><br><span class="line"><span class="built_in">print</span>(np.arange(<span class="number">6</span>).reshape(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建单位矩阵（二维数组）</span></span><br><span class="line"><span class="built_in">print</span>(np.eye(<span class="number">3</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建等间隔的一维数组</span></span><br><span class="line"><span class="built_in">print</span>(np.linspace(<span class="number">1</span>, <span class="number">10</span>, num=<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建二维随机数组</span></span><br><span class="line"><span class="built_in">print</span>(np.random.rand(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建二维随机整数数组（数值小于 5）</span></span><br><span class="line"><span class="built_in">print</span>(np.random.randint(<span class="number">5</span>, size=(<span class="number">2</span>,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依据自定义函数创建数组</span></span><br><span class="line"><span class="built_in">print</span>(np.fromfunction(<span class="keyword">lambda</span> i, j: i + j, (<span class="number">3</span>, <span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成二维示例数组（可以看作矩阵）</span></span><br><span class="line">A = np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line">B = np.array([[<span class="number">5</span>,<span class="number">6</span>],[<span class="number">7</span>,<span class="number">8</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一维示例数组[0:1]</span></span><br><span class="line"><span class="built_in">print</span>(np.random.random((<span class="number">3</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#np.random.rand()  生成一个[0,1)之间的随机浮点数或N维浮点数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成生成[0,1)之间随机浮点数</span></span><br><span class="line"><span class="built_in">print</span>(np.random.rand())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个形状为5的一维数组</span></span><br><span class="line"><span class="built_in">print</span>(np.random.rand(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成2x3的二维数组</span></span><br><span class="line"><span class="built_in">print</span>(np.random.rand(<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<h3 id="运算及转换"><a href="#运算及转换" class="headerlink" title="运算及转换"></a>运算及转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 矩阵乘法运算</span></span><br><span class="line"><span class="built_in">print</span>(np.dot(A, B))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 np.mat 将二维数组准确定义为矩阵，就可以直接使用 * 完成矩阵乘法计算 = np.dot(A,B)</span></span><br><span class="line"><span class="built_in">print</span>(np.mat(A) * np.mat(B))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵的转置</span></span><br><span class="line"><span class="built_in">print</span>(A.T)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵求逆</span></span><br><span class="line"><span class="built_in">print</span>(np.linalg.inv(A))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三角函数</span></span><br><span class="line"><span class="built_in">print</span>(np.sin(np.array([<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>])))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以自然对数函数为底数的指数函数</span></span><br><span class="line"><span class="built_in">print</span>(np.exp(a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组的方根的运算（开平方）</span></span><br><span class="line"><span class="built_in">print</span>(np.sqrt(a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组的方根的运算（立方）</span></span><br><span class="line"><span class="built_in">print</span>(np.power(a, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改数组形状（不改变原始数组）</span></span><br><span class="line">a.reshape(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改数组形状（会改变原始数组）</span></span><br><span class="line">a.resize(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 展平数组</span></span><br><span class="line">a.ravel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垂直拼合数组</span></span><br><span class="line"><span class="built_in">print</span>(np.vstack((a, b)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 水平拼合数组</span></span><br><span class="line"><span class="built_in">print</span>(np.hstack((a, b)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 沿纵轴分割数组</span></span><br><span class="line"><span class="built_in">print</span>(np.hsplit(a, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 沿横轴分割数组</span></span><br><span class="line"><span class="built_in">print</span>(np.vsplit(a, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回每列最大值</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">max</span>(a, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回每行最小值</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">min</span>(a, axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回每列最大值索引</span></span><br><span class="line"><span class="built_in">print</span>(np.argmax(a, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数组各列的中位数</span></span><br><span class="line"><span class="built_in">print</span>(np.median(a, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组各行的算术平均值</span></span><br><span class="line"><span class="built_in">print</span>(np.mean(a, axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组各列的加权平均值</span></span><br><span class="line"><span class="built_in">print</span>(np.average(a, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数组各行的方差</span></span><br><span class="line"><span class="built_in">print</span>(np.var(a, axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数组各列的标准偏差</span></span><br><span class="line"><span class="built_in">print</span>(np.std(a, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.rand()  生成一个浮点数或N维浮点数组，取数范围：正态分布的随机样本数</span></span><br><span class="line"><span class="built_in">print</span>(np.random.randn())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.random.randn(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.standard_normal(size=None)：生成一个浮点数或N维浮点数组，取数范围：标准正态分布随机样本</span></span><br><span class="line"><span class="built_in">print</span>(np.random.standard_normal(<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(np.random.standard_normal((<span class="number">2</span>,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.randint(low, high=None, size=None, dtype=&#x27;l&#x27;)：</span></span><br><span class="line"><span class="comment"># 生成一个整数或N维整数数组，取数范围：若high不为None时，取[low,high)之间随机整数，否则取值[0,low)之间随机整数。</span></span><br><span class="line"><span class="built_in">print</span>(np.random.randint(<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(np.random.randint(<span class="number">2</span>,size=<span class="number">5</span>))</span><br><span class="line"><span class="built_in">print</span>(np.random.randint(<span class="number">2</span>,<span class="number">6</span>,size=<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.choice(a, size=None, replace=True, p=None)：</span></span><br><span class="line"><span class="comment"># 从序列中获取元素，若a为整数，元素取值为np.range(a)中随机数；若a为数组，取值为a数组元素中随机元素</span></span><br><span class="line"><span class="built_in">print</span>(np.random.choice(<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(np.random.choice(np.array([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]),(<span class="number">2</span>,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.shuffle(x)：对X进行重排序，如果X为多维数组，整行重排</span></span><br><span class="line">list1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">np.random.shuffle(list1)</span><br><span class="line"><span class="built_in">print</span>(list1)</span><br><span class="line"></span><br><span class="line">arr = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"></span><br><span class="line">np.random.shuffle(arr)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># np.random.permutation(x)：与numpy.random.shuffle(x)函数功能相同，两者区别：peumutation(x)不会修改X的顺序</span></span><br><span class="line"><span class="built_in">print</span>(np.random.permutation(<span class="number">5</span>))<span class="comment">#生成一个range(5)随机顺序的数组</span></span><br><span class="line"></span><br><span class="line">list1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">np.random.permutation(list1)</span><br><span class="line"><span class="built_in">print</span>(list1)</span><br></pre></td></tr></table></figure>

<h2 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h2><h3 id="读取-写入文件"><a href="#读取-写入文件" class="headerlink" title="读取/写入文件"></a>读取/写入文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取CSV文件</span></span><br><span class="line">pd.DataFrame.from_csv(<span class="string">&quot;csv_file&quot;</span>)</span><br><span class="line"><span class="comment"># 读取CSV文件</span></span><br><span class="line">pd.read_csv(<span class="string">&quot;csv_file&quot;</span>)</span><br><span class="line"><span class="comment"># 读取Excel</span></span><br><span class="line">pd.read_excel(<span class="string">&quot;excel_file&quot;</span>)</span><br><span class="line"><span class="comment"># 将DataFrame写入CSV</span></span><br><span class="line"><span class="comment"># 其中以&quot;,&quot;为分隔符，不带索引或者使用index=None均可实现</span></span><br><span class="line">df.to_csv(<span class="string">&quot;data.csv&quot;</span>, sep=<span class="string">&quot;,&quot;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="DF相关信息"><a href="#DF相关信息" class="headerlink" title="DF相关信息"></a>DF相关信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataFrame基本统计信息</span></span><br><span class="line"><span class="comment"># 返回dataframe的每一列/属性的数量、均值、标准差、最小值、四分位数、最大值</span></span><br><span class="line">df.describe()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看DataFrame的基本信息量</span></span><br><span class="line">df.info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 索引和属性</span></span><br><span class="line">df.index  <span class="comment"># 索引</span></span><br><span class="line">df.columns  <span class="comment"># 属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新设置index</span></span><br><span class="line">df = df.set_index(<span class="string">&#x27;trade_date&#x27;</span>) </span><br></pre></td></tr></table></figure>

<h3 id="处理缺失值"><a href="#处理缺失值" class="headerlink" title="处理缺失值"></a>处理缺失值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除：axis=0代表列，axis=1代表行，how=&#x27;all&#x27;表示均为NaN删除，how=&#x27;any&#x27;表示存在某一个NaN则删除</span></span><br><span class="line">df.dropna(axis=<span class="number">0</span>,how=<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用全局常量填充缺失值</span></span><br><span class="line">df=df.fillna(value=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 均值填充</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].fillna(df[<span class="string">&#x27;a&#x27;</span>].means())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中位数填充</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].fillna(df[<span class="string">&#x27;a&#x27;</span>].median())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 众数填充</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].fillna(stats.mode(df[<span class="string">&#x27;a&#x27;</span>])[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用前一个数据进行填充</span></span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> stats</span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].fillna(method=<span class="string">&#x27;pad&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用后一个数据进行填充</span></span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> stats</span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].fillna(method=<span class="string">&#x27;bfill&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查缺失值NaN</span></span><br><span class="line">pd.isnull(df.<span class="built_in">open</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用&quot; &quot;替换空值</span></span><br><span class="line">df = df.replace(<span class="string">&quot; &quot;</span>,np.NaN)</span><br></pre></td></tr></table></figure>

<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除列</span></span><br><span class="line">df.drop(<span class="string">&#x27;open&#x27;</span>, axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="keyword">del</span> data[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"><span class="comment"># 删除行</span></span><br><span class="line">df.drop(df.index[[<span class="number">0</span>, <span class="number">2</span>]], inplace=<span class="literal">True</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某列转为浮点类型</span></span><br><span class="line">pd.to_numeric(df[<span class="string">&quot;open&quot;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将DataFrame转为Numpy</span></span><br><span class="line">df.as_matrix()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据属性和索引定位具体值 df.loc[索引,列名]</span></span><br><span class="line"><span class="comment"># 读取索引为&#x27;2019-11-07&#x27;的列名&#x27;open&#x27;的值</span></span><br><span class="line">df.loc[<span class="string">&#x27;2019-11-07&#x27;</span>,<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 累加操作</span></span><br><span class="line">data = data.cumsum()</span><br></pre></td></tr></table></figure>

<h3 id="合并数据集"><a href="#合并数据集" class="headerlink" title="合并数据集"></a>合并数据集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成数据集</span></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">0</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">1</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">2</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="comment"># 对多个DataFrame合并操作</span></span><br><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 数据输出(axis=0表示纵向合并，axis=1表示横向合并)</span></span><br><span class="line"><span class="comment"># 在数据输出纵向合并时index会有重复，可以使用index_ignore参数修改：</span></span><br><span class="line">res = pd.concat([df1, df2, df3], axis=<span class="number">0</span>, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 面对不同列名的多个DataFrame合并时，定义两个列名不同的DataFrame</span></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">0</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>], index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">1</span>, columns=[<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>], index=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="comment"># concat合并时参数join默认为outer，还可选择inner</span></span><br><span class="line">res = pd.concat([df1, df2], axis=<span class="number">0</span>, join=<span class="string">&#x27;outer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除了使用concat合并之外，还可以使用append对DataFrame进行纵向合并，注意append仅能纵向合并</span></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">0</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">1</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">res = df1.append(df2, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现大于2个DataFrame的append合并：</span></span><br><span class="line">df1 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">0</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">1</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df3 = pd.DataFrame(np.ones((<span class="number">3</span>,<span class="number">4</span>))*<span class="number">1</span>, columns=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">res = df1.append([df2, df3], ignore_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="数据统计"><a href="#数据统计" class="headerlink" title="数据统计"></a>数据统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 汇总统计</span></span><br><span class="line"><span class="built_in">print</span>(df.describe())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 非NaN值统计</span></span><br><span class="line"><span class="built_in">print</span>(df.count())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 最大值和最小值</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">min</span>())</span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">max</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 最大值和最小值所对应的索引值，由于多维度，不指定具体的属性将会报错</span></span><br><span class="line"><span class="comment"># 另外idxmin/idmax仅返回index的下标</span></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;date&#x27;</span>][df[<span class="string">&#x27;open&#x27;</span>].idxmin()])</span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;open&#x27;</span>].idxmax())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 数据集的分位数，默认为0.5 显示2/4分位数</span></span><br><span class="line"><span class="comment"># df.quantile(0.75)，显示3/4分位数</span></span><br><span class="line"><span class="built_in">print</span>(df.quantile())</span><br><span class="line"><span class="built_in">print</span>(df.quantile(<span class="number">0.75</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 列值总和</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 各列均值</span></span><br><span class="line"><span class="built_in">print</span>(df.mean())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8 各列中位数</span></span><br><span class="line"><span class="built_in">print</span>(df.mean())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9 各列根据平均值计算平均绝对离差，即平均绝对误差（Mean Absolute Deviation）</span></span><br><span class="line"><span class="built_in">print</span>(df.mad())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10 各列方差</span></span><br><span class="line"><span class="built_in">print</span>(df.var())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11 各列标准差</span></span><br><span class="line"><span class="built_in">print</span>(df.std())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12 各列偏度，即三阶标准化矩</span></span><br><span class="line"><span class="built_in">print</span>(df.skew())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 13 各列峰度</span></span><br><span class="line"><span class="built_in">print</span>(df.kurt())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 14 各列累加和</span></span><br><span class="line"><span class="built_in">print</span>(df.cumsum())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 15 各列累加和最大值和最小值</span></span><br><span class="line"><span class="built_in">print</span>(df.cummin())</span><br><span class="line"><span class="built_in">print</span>(df.cumax())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 16 各列累积</span></span><br><span class="line"><span class="built_in">print</span>(df.cumprod())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 17 各列一阶方差</span></span><br><span class="line"><span class="built_in">print</span>(df.diff())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 18 各列百分数变化</span></span><br><span class="line"><span class="built_in">print</span>(df.pct_change())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 19 修改列名</span></span><br><span class="line">df.columns = [<span class="string">&quot;f1&quot;</span>,<span class="string">&quot;f2&quot;</span>,<span class="string">&quot;f3&quot;</span>,<span class="string">&quot;f4&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 随机生成df（默认4列[A,B,C,D]）</span></span><br><span class="line">pd.util.testing.makeDataFrame().head(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 21 将excel等表格转为df</span></span><br><span class="line">（<span class="number">1</span>）复制表格</span><br><span class="line">（<span class="number">2</span>）执行pd.read_clipboard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 22 查看df的当前内存用量</span></span><br><span class="line">df.info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 23 限制读取行数</span></span><br><span class="line">reader = pd.read_csv(<span class="string">&quot;http://...&quot;</span>,chunksize=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 24 显示所有列</span></span><br><span class="line">pd.set_option(<span class="string">&quot;display.max_columns&quot;</span>, <span class="literal">None</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 25 改变浮点数显示位数(1位)</span></span><br><span class="line">pd.set_option(<span class="string">&quot;display.precision&quot;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 26 修改样式</span></span><br><span class="line">df.style.bar(<span class="string">&quot;age&quot;</span>,vmin=<span class="number">0</span>)<span class="comment"># 年龄属性最小值为0画横向柱状</span></span><br><span class="line">df.style.hide_index()<span class="comment"># 隐藏索引</span></span><br><span class="line">df.style.highlight_max(<span class="string">&quot;label&quot;</span>)<span class="comment"># 高亮标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选取前n行数据</span></span><br><span class="line">df.head(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据排序</span></span><br><span class="line">df = df.sort_values(<span class="string">&quot;open&quot;</span>,ascending = <span class="literal">False</span>)</span><br><span class="line">//对具体某列进行排序，其中ascending=<span class="literal">False</span>表示降序，而<span class="literal">True</span>为升序，其默认ascending为升序</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤数据</span></span><br><span class="line">df = df[df[<span class="string">&quot;open&quot;</span>]&gt;<span class="number">5555</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><p>使用matplotlib和numpy配合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 单一数据可视化</span></span><br><span class="line"><span class="comment"># 生成1000个随机数并数据可视化</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">data = pd.Series(np.random.randn(<span class="number">1000</span>),index=np.arange(<span class="number">1000</span>))</span><br><span class="line">data.plot()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多维数据可视化</span></span><br><span class="line"><span class="comment"># 生成1000×4维度的随机数并数据可视化</span></span><br><span class="line">data = pd.DataFrame(np.random.randn(<span class="number">1000</span>,<span class="number">4</span>),index=np.arange(<span class="number">1000</span>),columns=<span class="built_in">list</span>(<span class="string">&quot;ABCD&quot;</span>))</span><br><span class="line">data.plot()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对多维数据进行散点图展示</span></span><br><span class="line">ax = data.plot.scatter(x=<span class="string">&#x27;A&#x27;</span>, y=<span class="string">&#x27;B&#x27;</span>, color=<span class="string">&#x27;DarkBlue&#x27;</span>, label=<span class="string">&quot;Class 1(A/B)&quot;</span>)</span><br><span class="line">bx = data.plot.scatter(x=<span class="string">&#x27;A&#x27;</span>, y=<span class="string">&#x27;C&#x27;</span>, color=<span class="string">&#x27;LightBlue&#x27;</span>, label=<span class="string">&quot;Class 2(A/C)&quot;</span>,ax=ax)</span><br><span class="line">data.plot.scatter(x=<span class="string">&#x27;A&#x27;</span>, y=<span class="string">&#x27;D&#x27;</span>, color=<span class="string">&#x27;LightGreen&#x27;</span>, label=<span class="string">&#x27;Class 3(A/D)&#x27;</span>, ax=bx)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>在Python中一切皆为对象，所有变量被赋值后均遵循对象引用机制，在运行时需要再内存中开辟一个空间，计算完成后将结果输出至永久性存储器，当数据量过大时易出现OOM（out of memory），即内存爆炸。</p>
<p>当一个对象不再被调用时，当该对象的引用计数指针数为0，需要被回收，可以通过以下命令查看指定变量被引用的次数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">a = <span class="number">123</span></span><br><span class="line"><span class="built_in">print</span>(sys.getrefcount(a))</span><br><span class="line"><span class="comment"># result:2 一次来源于声明a变量；一次来源于getrefcount(a)</span></span><br></pre></td></tr></table></figure>

<p>手动释放内存：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gc</span><br><span class="line">gc.collect()</span><br><span class="line">show_memory_info(<span class="string">&#x27;collected&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当两个局部变量循环引用时，即当a与b互相引用时，即使函数完成后其引用数也不为0，对于该情况时可以采取人工回收。</p>
<h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><h3 id="计数引用"><a href="#计数引用" class="headerlink" title="计数引用"></a>计数引用</h3><p>当一个对象不再调用的时候，也就是当这个对象的引用计数（指针数）为 0 的时候，说明这个对象永不可达，自然它也就成为了垃圾，需要被回收。可以简单的理解为没有任何变量再指向它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前 python 程序占用的内存大小</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_memory_info</span>(<span class="params">hint</span>):</span></span><br><span class="line">    pid = os.getpid()</span><br><span class="line">    p = psutil.Process(pid)</span><br><span class="line"></span><br><span class="line">    info = p.memory_full_info()</span><br><span class="line">    memory = info.uss / <span class="number">1024.</span>/ <span class="number">1024</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125; memory used: &#123;&#125; MB&#x27;</span>.<span class="built_in">format</span>(hint, memory))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    show_memory_info(<span class="string">&#x27;initial&#x27;</span>)</span><br><span class="line">    a = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]</span><br><span class="line">    show_memory_info(<span class="string">&#x27;after a created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">show_memory_info(<span class="string">&#x27;finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########## 输出 ##########</span></span><br><span class="line">initial memory used: <span class="number">47.19140625</span> MB</span><br><span class="line">after a created memory used: <span class="number">433.91015625</span> MB</span><br><span class="line">finished memory used: <span class="number">48.109375</span> MB</span><br></pre></td></tr></table></figure>

<p>可以看到调用函数 func()，在列表 a 被创建之后，内存占用迅速增加到了 433 MB：而在函数调用结束后，内存则返回正常。这是因为，函数内部声明的列表 a 是局部变量，在函数返回后，局部变量的引用会注销掉；此时，列表 a 所指代对象的引用数为 0，Python 便会执行垃圾回收，因此之前占用的大量内存就又回来了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span></span></span><br><span class="line"><span class="function"> <span class="title">func</span>():</span></span><br><span class="line">    show_memory_info(<span class="string">&#x27;initial&#x27;</span>)</span><br><span class="line"><span class="keyword">global</span> a    </span><br><span class="line">a = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]</span><br><span class="line">    show_memory_info(<span class="string">&#x27;after a created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">show_memory_info(<span class="string">&#x27;finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########## 输出 ##########</span></span><br><span class="line"></span><br><span class="line">initial memory used: <span class="number">48.88671875</span> MB</span><br><span class="line">after a created memory used: <span class="number">433.94921875</span> MB</span><br><span class="line">finished memory used: <span class="number">433.94921875</span> MB</span><br></pre></td></tr></table></figure>

<p>新的这段代码中，global a 表示将 a 声明为全局变量。那么，即使函数返回后，列表的引用依然存在，于是对象就不会被垃圾回收掉，依然占用大量内存。同样，如果我们把生成的列表返回，然后在主程序中接收，那么引用依然存在，垃圾回收就不会被触发，大量内存仍然被占用着：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span></span></span><br><span class="line"><span class="function"> <span class="title">func</span>():</span></span><br><span class="line">    show_memory_info(<span class="string">&#x27;initial&#x27;</span>)</span><br><span class="line">    a = [i <span class="keyword">for</span> i <span class="keyword">in</span> derange(<span class="number">10000000</span>)]</span><br><span class="line">    show_memory_info(<span class="string">&#x27;after a created&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">a = func()</span><br><span class="line">show_memory_info(<span class="string">&#x27;finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########## 输出 ##########</span></span><br><span class="line"></span><br><span class="line">initial memory used: <span class="number">47.96484375</span> MB</span><br><span class="line">after a created memory used: <span class="number">434.515625</span> MB</span><br><span class="line">finished memory used: <span class="number">434.515625</span> MB</span><br></pre></td></tr></table></figure>

<h3 id="循环回收"><a href="#循环回收" class="headerlink" title="循环回收"></a>循环回收</h3><p>如果有两个对象，它们互相引用，并且不再被别的对象所引用，那么它们应该被垃圾回收吗？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span></span></span><br><span class="line"><span class="function"> <span class="title">func</span>():</span></span><br><span class="line">    show_memory_info(<span class="string">&#x27;initial&#x27;</span>)</span><br><span class="line">    a = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]</span><br><span class="line">    b = [i </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]</span><br><span class="line">    show_memory_info(<span class="string">&#x27;after a, b created&#x27;</span>)</span><br><span class="line">    a.append(b)</span><br><span class="line">    b.append(a)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">show_memory_info(<span class="string">&#x27;finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########## 输出 ##########</span></span><br><span class="line"></span><br><span class="line">initial memory used: <span class="number">47.984375</span> MB</span><br><span class="line">after a, b created memory used: <span class="number">822.73828125</span> MB</span><br><span class="line">finished memory used: <span class="number">821.73046875</span> MB</span><br></pre></td></tr></table></figure>

<p>从结果显而易见，它们并没有被回收，但是从程序上来看，当这个函数结束的时候，作为局部变量的a，b就已经从程序意义上不存在了。但是因为它们的互相引用，导致了它们的引用数都不为0。</p>
<p>这时要如何规避呢1. 从代码逻辑上进行整改，避免这种循环引用2. 通过人工回收</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    show_memory_info(<span class="string">&#x27;initial&#x27;</span>)</span><br><span class="line">    a = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]    </span><br><span class="line">    b = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>)]</span><br><span class="line">    show_memory_info(<span class="string">&#x27;after a, b created&#x27;</span>)</span><br><span class="line">    a.append(b)</span><br><span class="line">    b.append(a)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">gc.collect()</span><br><span class="line">show_memory_info(<span class="string">&#x27;finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########## 输出 ##########</span></span><br><span class="line"></span><br><span class="line">initial memory used: <span class="number">49.51171875</span> MB</span><br><span class="line">after a, b created memory used: <span class="number">824.1328125</span> MB</span><br><span class="line">finished memory used: <span class="number">49.98046875</span> MB</span><br></pre></td></tr></table></figure>

<p>python面对循环引用有自动垃圾回收算法：</p>
<p>（1）自动垃圾回收算法——标记清除（mark-sweep）</p>
<p>垃圾回收机制会把所有变量都打上标记，将没有标记的对象进行回收，mark-sweep使用双向链表维护一个数据结构，通常仅包含容器类对象：list、dict、tuplle、instance。</p>
<p>（2）自动垃圾回收算法——分代回收（generational）</p>
<p>分代回收是一种以空间换时间的操作，python根据对象的存活时间划分为不同的集合，其中每一个集合称为一个代，将内存分为3个代，分别为:</p>
<ul>
<li><p>年轻代（第0代）</p>
</li>
<li><p>中年代（第1代）</p>
</li>
<li><p>老年代（第2代）</p>
</li>
</ul>
<p>对应3个链表，对象的存活时间越大，垃圾收集频率越低。</p>
<p>新创建的对象均被分配在年轻代，当年轻代链表总数达到上限时，python垃圾回收机制会被触发，将待回收对象回收，将暂不回收被移到中年代，老年代的对象是存活时间最久的对象。</p>
<h2 id="random"><a href="#random" class="headerlink" title="random"></a>random</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment"># 随机生成0-1的随机数</span></span><br><span class="line">random.random()<span class="comment">#0.444365931841868</span></span><br><span class="line"><span class="comment"># 随机生成2-5之间的整数</span></span><br><span class="line">random.randint(<span class="number">2</span>,<span class="number">5</span>)<span class="comment">#3</span></span><br><span class="line"><span class="comment"># 随机生成2-5之间的有理数</span></span><br><span class="line">random.uniform(<span class="number">2</span>,<span class="number">5</span>)<span class="comment">#2.391457672495461</span></span><br><span class="line"><span class="comment"># 从[10,12,14,...,100]随机生成1个数</span></span><br><span class="line">random.randrange(<span class="number">10</span>,<span class="number">100</span>,<span class="number">2</span>)<span class="comment">#72</span></span><br><span class="line"><span class="comment"># 从[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]随机生成1个项</span></span><br><span class="line">random.choice([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>])<span class="comment">#&#x27;c&#x27;</span></span><br><span class="line"><span class="comment"># 打乱列表</span></span><br><span class="line">p = [<span class="string">&#x27;python&#x27;</span>,<span class="string">&#x27;is&#x27;</span>,<span class="string">&#x27;powerful&#x27;</span>]</span><br><span class="line">random.shuffle(p)</span><br><span class="line"><span class="built_in">print</span>(p)<span class="comment"># [&#x27;powerful&#x27;, &#x27;is&#x27;, &#x27;python&#x27;]</span></span><br><span class="line"><span class="comment"># 打乱顺序且随机选取3个数</span></span><br><span class="line">random.sample([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],<span class="number">3</span>)<span class="comment">#[1, 3, 2]</span></span><br><span class="line"><span class="comment"># 随机选取3个数</span></span><br><span class="line">random.sample([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],<span class="number">3</span>)<span class="comment">#[1, 3, 2]</span></span><br><span class="line"><span class="comment"># 指定前5次随机生成数相同</span></span><br><span class="line">random.seed(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Python/" data-id="ckmzn8px00018j2td8pv489sj" data-title="Python function / package" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/01/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2021/03/31/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Elasticsearch/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">日常笔记——Elasticsearch</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Study/">Study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">Testing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/idea/">idea</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94k8s/">日常笔记——k8s</a>
          </li>
        
          <li>
            <a href="/2021/04/01/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Python/">Python function / package</a>
          </li>
        
          <li>
            <a href="/2021/03/31/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Elasticsearch/">日常笔记——Elasticsearch</a>
          </li>
        
          <li>
            <a href="/2021/03/25/%E6%9C%AC%E5%9C%B0%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7%E2%80%94%E2%80%94Coverage/">本地单元测试统计工具——Coverage</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>