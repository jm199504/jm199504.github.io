<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>日常笔记——SQL | Jimmy&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="概述：日常笔记——SQL">
<meta property="og:type" content="article">
<meta property="og:title" content="日常笔记——SQL">
<meta property="og:url" content="http://example.com/2020/09/17/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94SQL/index.html">
<meta property="og:site_name" content="Jimmy&#39;s blog">
<meta property="og:description" content="概述：日常笔记——SQL">
<meta property="og:locale">
<meta property="og:image" content="https://docimg2.docs.qq.com/image/3YAHfBUcIEe_1Je6F2ia2g?w=310&h=600">
<meta property="og:image" content="https://docimg2.docs.qq.com/image/Md0GpIhsHls23f6YbL1fUw?w=817&h=124">
<meta property="article:published_time" content="2020-09-17T15:21:12.804Z">
<meta property="article:modified_time" content="2021-04-02T01:59:49.575Z">
<meta property="article:author" content="Jimmy Guo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://docimg2.docs.qq.com/image/3YAHfBUcIEe_1Je6F2ia2g?w=310&h=600">
  
    <link rel="alternate" href="/atom.xml" title="Jimmy's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jimmy&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-日常笔记——SQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/17/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94SQL/" class="article-date">
  <time class="dt-published" datetime="2020-09-17T15:21:12.804Z" itemprop="datePublished">2020-09-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      日常笔记——SQL
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>概述：日常笔记——SQL</p>
<span id="more"></span>

<h3 id="1-基础命令"><a href="#1-基础命令" class="headerlink" title="1.基础命令"></a>1.基础命令</h3><h4 id="（1）数据库模式定义语言DDL-Data-Definition-Language"><a href="#（1）数据库模式定义语言DDL-Data-Definition-Language" class="headerlink" title="（1）数据库模式定义语言DDL(Data Definition Language)"></a>（1）数据库模式定义语言DDL(Data Definition Language)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">查看服务器版本</span><br><span class="line">select version();</span><br><span class="line"></span><br><span class="line">查看所有数据库</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">切换到指定数据库</span><br><span class="line">use mysql;</span><br><span class="line"></span><br><span class="line">查看数据库下所有表</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">创建名为school的数据库并设置默认的字符集和排序方式</span><br><span class="line">create database school default charset utf8;</span><br><span class="line"></span><br><span class="line">如果存在名为school的数据库就删除它</span><br><span class="line">drop database if exists school;</span><br><span class="line"></span><br><span class="line">创建学院表</span><br><span class="line">create table tb_college</span><br><span class="line">(</span><br><span class="line">collid 		int auto_increment comment &#39;编号&#39;,</span><br><span class="line">collname 	varchar(50) not null comment &#39;名称&#39;,</span><br><span class="line">collintro 	varchar(500) default &#39;&#39; comment &#39;介绍&#39;,</span><br><span class="line">primary key (collid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">创建学生表</span><br><span class="line">create table tb_student</span><br><span class="line">(</span><br><span class="line">stuid 		int not null comment &#39;学号&#39;,</span><br><span class="line">stuname 	varchar(20) not null comment &#39;姓名&#39;,</span><br><span class="line">stusex 		boolean default 1 comment &#39;性别&#39;,</span><br><span class="line">stubirth 	date not null comment &#39;出生日期&#39;,</span><br><span class="line">stuaddr 	varchar(255) default &#39;&#39; comment &#39;籍贯&#39;,</span><br><span class="line">collid 		int not null comment &#39;所属学院&#39;,</span><br><span class="line">primary key (stuid),</span><br><span class="line">foreign key (collid) references tb_college (collid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">创建教师表</span><br><span class="line">create table tb_teacher</span><br><span class="line">(</span><br><span class="line">teaid 		int not null comment &#39;工号&#39;,</span><br><span class="line">teaname 	varchar(20) not null comment &#39;姓名&#39;,</span><br><span class="line">teatitle 	varchar(10) default &#39;助教&#39; comment &#39;职称&#39;,</span><br><span class="line">collid 		int not null comment &#39;所属学院&#39;,</span><br><span class="line">primary key (teaid),</span><br><span class="line">foreign key (collid) references tb_college (collid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">创建课程表</span><br><span class="line">create table tb_course</span><br><span class="line">(</span><br><span class="line">couid 		int not null comment &#39;编号&#39;,</span><br><span class="line">couname 	varchar(50) not null comment &#39;名称&#39;,</span><br><span class="line">coucredit 	int not null comment &#39;学分&#39;,</span><br><span class="line">teaid 		int not null comment &#39;授课老师&#39;,</span><br><span class="line">primary key (couid),</span><br><span class="line">foreign key (teaid) references tb_teacher (teaid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">创建选课记录表</span><br><span class="line">create table tb_record</span><br><span class="line">(</span><br><span class="line">recid 		int auto_increment comment &#39;选课记录编号&#39;,</span><br><span class="line">sid 		int not null comment &#39;选课学生&#39;,</span><br><span class="line">cid 		int not null comment &#39;所选课程&#39;,</span><br><span class="line">seldate 	datetime default now() comment &#39;选课时间日期&#39;,</span><br><span class="line">score 		decimal(4,1) comment &#39;考试成绩&#39;,</span><br><span class="line">primary key (recid),</span><br><span class="line">foreign key (sid) references tb_student (stuid),</span><br><span class="line">foreign key (cid) references tb_course (couid),</span><br><span class="line">unique (sid, cid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">查看数据库的字符集</span><br><span class="line">+----------+---------------------------------+---------------------+--------+</span><br><span class="line">| Charset  | Description                     | Default collation   | Maxlen |</span><br><span class="line">+----------+---------------------------------+---------------------+--------+</span><br><span class="line">| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |</span><br><span class="line">| dec8     | DEC West European               | dec8_swedish_ci     |      1 |</span><br><span class="line">| cp850    | DOS West European               | cp850_general_ci    |      1 |</span><br><span class="line">| hp8      | HP West European                | hp8_english_ci      |      1 |</span><br><span class="line">| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |</span><br><span class="line">| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |</span><br><span class="line">| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |</span><br><span class="line">| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |</span><br><span class="line">| ascii    | US ASCII                        | ascii_general_ci    |      1 |</span><br><span class="line">| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |</span><br><span class="line">| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |</span><br><span class="line">| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |</span><br><span class="line">| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |</span><br><span class="line">| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |</span><br><span class="line">| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |</span><br><span class="line">| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |</span><br><span class="line">| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |</span><br><span class="line">| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |</span><br><span class="line">| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 |</span><br><span class="line">| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |</span><br><span class="line">| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |</span><br><span class="line">| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 |</span><br><span class="line">| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |</span><br><span class="line">| cp866    | DOS Russian                     | cp866_general_ci    |      1 |</span><br><span class="line">| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |</span><br><span class="line">| macce    | Mac Central European            | macce_general_ci    |      1 |</span><br><span class="line">| macroman | Mac West European               | macroman_general_ci |      1 |</span><br><span class="line">| cp852    | DOS Central European            | cp852_general_ci    |      1 |</span><br><span class="line">| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |</span><br><span class="line">| utf8mb4  | UTF-8 Unicode                   | utf8mb4_general_ci  |      4 |</span><br><span class="line">| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |</span><br><span class="line">| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |</span><br><span class="line">| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |</span><br><span class="line">| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |</span><br><span class="line">| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |</span><br><span class="line">| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |</span><br><span class="line">| binary   | Binary pseudo charset           | binary              |      1 |</span><br><span class="line">| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |</span><br><span class="line">| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |</span><br><span class="line">| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |</span><br><span class="line">| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 |</span><br><span class="line">+----------+---------------------------------+---------------------+--------+</span><br></pre></td></tr></table></figure>

<h4 id="（2）数据操纵语言DML（Data-Manipulation-Language）"><a href="#（2）数据操纵语言DML（Data-Manipulation-Language）" class="headerlink" title="（2）数据操纵语言DML（Data Manipulation Language）"></a>（2）数据操纵语言DML（Data Manipulation Language）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">-- 插入学院数据</span><br><span class="line">insert into tb_college (collname, collintro) values </span><br><span class="line">(&#39;计算机学院&#39;, &#39;创建于1956年是我国首批建立计算机专业。学院现有计算机科学与技术一级学科和网络空间安全一级学科博士学位授予权，其中计算机科学与技术一级学科具有博士后流动站。计算机科学与技术一级学科在2017年全国第四轮学科评估中评为A；2019 U.S.News全球计算机学科排名26名；ESI学科排名0.945‰，进入全球前1‰，位列第43位。&#39;),</span><br><span class="line">(&#39;外国语学院&#39;, &#39;1998年浙江大学、杭州大学、浙江农业大学、浙江医科大学四校合并，成立新的浙江大学。1999年原浙江大学外语系、原杭州大学外国语学院、原杭州大学大外部、原浙江农业大学公外部、原浙江医科大学外语教学部合并，成立浙江大学外国语学院。2003年学院更名为浙江大学外国语言文化与国际交流学院。&#39;),</span><br><span class="line">(&#39;经济管理学院&#39;, &#39;四川大学经济学院历史悠久、传承厚重，其前身是创办于1905年的四川大学经济科,距今已有100多年的历史。已故著名经济学家彭迪先、张与九、蒋学模、胡寄窗、陶大镛、胡代光，以及当代著名学者刘诗白等曾先后在此任教或学习。在长期的办学过程中，学院坚持以马克思主义的立场、观点、方法为指导，围绕建设世界一流经济学院的奋斗目标，做实“两个伟大”深度融合，不断提高党的建设质量与科学推进一流事业深度融合。&#39;);</span><br><span class="line"></span><br><span class="line">-- 插入学生数据</span><br><span class="line">insert into tb_student (stuid, stuname, stusex, stubirth, stuaddr, collid) values</span><br><span class="line">(1001, &#39;杨逍&#39;, 1, &#39;1990-3-4&#39;, &#39;四川成都&#39;, 1),</span><br><span class="line">(1002, &#39;任我行&#39;, 1, &#39;1992-2-2&#39;, &#39;湖南长沙&#39;, 1),</span><br><span class="line">(1033, &#39;王语嫣&#39;, 0, &#39;1989-12-3&#39;, &#39;四川成都&#39;, 1),</span><br><span class="line">(1572, &#39;岳不群&#39;, 1, &#39;1993-7-19&#39;, &#39;陕西咸阳&#39;, 1),</span><br><span class="line">(1378, &#39;纪嫣然&#39;, 0, &#39;1995-8-12&#39;, &#39;四川绵阳&#39;, 1),</span><br><span class="line">(1954, &#39;林平之&#39;, 1, &#39;1994-9-20&#39;, &#39;福建莆田&#39;, 1),</span><br><span class="line">(2035, &#39;东方不败&#39;, 1, &#39;1988-6-30&#39;, null, 2),</span><br><span class="line">(3011, &#39;林震南&#39;, 1, &#39;1985-12-12&#39;, &#39;福建莆田&#39;, 3),</span><br><span class="line">(3755, &#39;项少龙&#39;, 1, &#39;1993-1-25&#39;, null, 3),</span><br><span class="line">(3923, &#39;杨不悔&#39;, 0, &#39;1985-4-17&#39;, &#39;四川成都&#39;, 3),</span><br><span class="line">(4040, &#39;隔壁老王&#39;, 1, &#39;1989-1-1&#39;, &#39;四川成都&#39;, 2);</span><br><span class="line"></span><br><span class="line">-- 删除学生数据</span><br><span class="line">delete from tb_student where stuid&#x3D;4040;</span><br><span class="line"></span><br><span class="line">-- 更新学生数据</span><br><span class="line">update tb_student set stuname&#x3D;&#39;杨过&#39;, stuaddr&#x3D;&#39;湖南长沙&#39; where stuid&#x3D;1001;</span><br><span class="line"></span><br><span class="line">-- 插入老师数据</span><br><span class="line">insert into tb_teacher (teaid, teaname, teatitle, collid) values </span><br><span class="line">(1122, &#39;张三丰&#39;, &#39;教授&#39;, 1),</span><br><span class="line">(1133, &#39;宋远桥&#39;, &#39;副教授&#39;, 1),</span><br><span class="line">(1144, &#39;杨逍&#39;, &#39;副教授&#39;, 1),</span><br><span class="line">(2255, &#39;范遥&#39;, &#39;副教授&#39;, 2),</span><br><span class="line">(3366, &#39;韦一笑&#39;, &#39;讲师&#39;, 3);</span><br><span class="line"></span><br><span class="line">-- 插入课程数据</span><br><span class="line">insert into tb_course (couid, couname, coucredit, teaid) values </span><br><span class="line">(1111, &#39;Python程序设计&#39;, 3, 1122),</span><br><span class="line">(2222, &#39;Web前端开发&#39;, 2, 1122),</span><br><span class="line">(3333, &#39;操作系统&#39;, 4, 1122),</span><br><span class="line">(4444, &#39;计算机网络&#39;, 2, 1133),</span><br><span class="line">(5555, &#39;编译原理&#39;, 4, 1144),</span><br><span class="line">(6666, &#39;算法和数据结构&#39;, 3, 1144),</span><br><span class="line">(7777, &#39;经贸法语&#39;, 3, 2255),</span><br><span class="line">(8888, &#39;成本会计&#39;, 2, 3366),</span><br><span class="line">(9999, &#39;审计学&#39;, 3, 3366);</span><br><span class="line"></span><br><span class="line">-- 插入选课数据</span><br><span class="line">insert into tb_record (sid, cid, seldate, score) values </span><br><span class="line">(1001, 1111, &#39;2017-09-01&#39;, 95),</span><br><span class="line">(1001, 2222, &#39;2017-09-01&#39;, 87.5),</span><br><span class="line">(1001, 3333, &#39;2017-09-01&#39;, 100),</span><br><span class="line">(1001, 4444, &#39;2018-09-03&#39;, null),</span><br><span class="line">(1001, 6666, &#39;2017-09-02&#39;, 100),</span><br><span class="line">(1002, 1111, &#39;2017-09-03&#39;, 65),</span><br><span class="line">(1002, 5555, &#39;2017-09-01&#39;, 42),</span><br><span class="line">(1033, 1111, &#39;2017-09-03&#39;, 92.5),</span><br><span class="line">(1033, 4444, &#39;2017-09-01&#39;, 78),</span><br><span class="line">(1033, 5555, &#39;2017-09-01&#39;, 82.5),</span><br><span class="line">(1572, 1111, &#39;2017-09-02&#39;, 78),</span><br><span class="line">(1378, 1111, &#39;2017-09-05&#39;, 82),</span><br><span class="line">(1378, 7777, &#39;2017-09-02&#39;, 65.5),</span><br><span class="line">(2035, 7777, &#39;2018-09-03&#39;, 88),</span><br><span class="line">(2035, 9999, default, null),</span><br><span class="line">(3755, 1111, default, null),</span><br><span class="line">(3755, 8888, default, null),</span><br><span class="line">(3755, 9999, &#39;2017-09-01&#39;, 92);</span><br><span class="line"></span><br><span class="line">-- 查询所有学生信息</span><br><span class="line">select * from tb_student;</span><br><span class="line"></span><br><span class="line">-- 查询所有课程名称及学分(投影和别名)</span><br><span class="line">select couname, coucredit from tb_course;</span><br><span class="line">select couname as 课程名称, coucredit as 学分 from tb_course;</span><br><span class="line"></span><br><span class="line">-- 查询所有学生的姓名和性别(条件运算)</span><br><span class="line">select stuname as 姓名, case stusex when 1 then &#39;男&#39; else &#39;女&#39; end as 性别 from tb_student;</span><br><span class="line">select stuname as 姓名, if(stusex, &#39;男&#39;, &#39;女&#39;) as 性别 from tb_student;</span><br><span class="line"></span><br><span class="line">-- 查询所有女学生的姓名和出生日期(筛选)</span><br><span class="line">select stuname, stubirth from tb_student where stusex&#x3D;0;</span><br><span class="line"></span><br><span class="line">-- 查询所有80后学生的姓名、性别和出生日期(筛选)</span><br><span class="line">select stuname, stusex, stubirth from tb_student where stubirth&gt;&#x3D;&#39;1980-1-1&#39; and stubirth&lt;&#x3D;&#39;1989-12-31&#39;;</span><br><span class="line">select stuname, stusex, stubirth from tb_student where stubirth between &#39;1980-1-1&#39; and &#39;1989-12-31&#39;;</span><br><span class="line"></span><br><span class="line">-- 查询姓&quot;杨&quot;的学生姓名和性别(模糊)</span><br><span class="line">select stuname, stusex from tb_student where stuname like &#39;杨%&#39;;</span><br><span class="line"></span><br><span class="line">-- 查询姓&quot;杨&quot;名字两个字的学生姓名和性别(模糊)</span><br><span class="line">select stuname, stusex from tb_student where stuname like &#39;杨_&#39;;</span><br><span class="line"></span><br><span class="line">-- 查询姓&quot;杨&quot;名字三个字的学生姓名和性别(模糊)</span><br><span class="line">select stuname, stusex from tb_student where stuname like &#39;杨__&#39;;</span><br><span class="line"></span><br><span class="line">-- 查询名字中有&quot;不&quot;字或&quot;嫣&quot;字的学生的姓名(模糊)</span><br><span class="line">select stuname, stusex from tb_student where stuname like &#39;%不%&#39; or stuname like &#39;%嫣%&#39;;</span><br><span class="line"></span><br><span class="line">-- 查询没有录入家庭住址的学生姓名(空值)</span><br><span class="line">select stuname from tb_student where stuaddr is null;</span><br><span class="line"></span><br><span class="line">-- 查询录入了家庭住址的学生姓名(空值)</span><br><span class="line">select stuname from tb_student where stuaddr is not null;</span><br><span class="line"></span><br><span class="line">-- 查询学生选课的所有日期(去重)</span><br><span class="line">select distinct seldate from tb_record;</span><br><span class="line"></span><br><span class="line">-- 查询学生的家庭住址(去重)</span><br><span class="line">select distinct stuaddr from tb_student where stuaddr is not null;</span><br><span class="line"></span><br><span class="line">-- 查询男学生的姓名和生日按年龄从大到小排列(排序)</span><br><span class="line">select stuname as 姓名, datediff(curdate(), stubirth) div 365 as 年龄 from tb_student where stusex&#x3D;1 order by 年龄 desc;</span><br><span class="line"></span><br><span class="line">-- 查询年龄最大的学生的出生日期(聚合函数)</span><br><span class="line">select min(stubirth) from tb_student;</span><br><span class="line"></span><br><span class="line">-- 查询年龄最小的学生的出生日期(聚合函数)</span><br><span class="line">select max(stubirth) from tb_student;</span><br><span class="line"></span><br><span class="line">-- 查询男女学生的人数(分组和聚合函数)</span><br><span class="line">select stusex, count(*) from tb_student group by stusex;</span><br><span class="line"></span><br><span class="line">-- 查询课程编号为1111的课程的平均成绩(筛选和聚合函数)</span><br><span class="line">select avg(score) from tb_record where cid&#x3D;1111;</span><br><span class="line"></span><br><span class="line">-- 查询学号为1001的学生所有课程的平均分(筛选和聚合函数)</span><br><span class="line">select avg(score) from tb_record where sid&#x3D;1001;</span><br><span class="line"></span><br><span class="line">-- 查询每个学生的学号和平均成绩(分组和聚合函数)</span><br><span class="line">select sid as 学号, avg(score) as 平均分 from tb_record group by sid;</span><br><span class="line"></span><br><span class="line">-- 查询平均成绩大于等于90分的学生的学号和平均成绩</span><br><span class="line">-- 分组以前的筛选使用where子句 &#x2F; 分组以后的筛选使用having子句</span><br><span class="line">select sid as 学号, avg(score) as 平均分 from tb_record group by sid having 平均分&gt;&#x3D;90;</span><br><span class="line"></span><br><span class="line">-- 查询年龄最大的学生的姓名(子查询&#x2F;嵌套的查询)</span><br><span class="line">select stuname from tb_student where stubirth&#x3D;( select min(stubirth) from tb_student );</span><br><span class="line"></span><br><span class="line">-- 查询年龄最大的学生姓名和年龄(子查询+运算)</span><br><span class="line">select stuname as 姓名, datediff(curdate(), stubirth) div 365 as 年龄 from tb_student where stubirth&#x3D;( select min(stubirth) from tb_student );</span><br><span class="line"></span><br><span class="line">-- 查询选了两门以上的课程的学生姓名(子查询&#x2F;分组条件&#x2F;集合运算)</span><br><span class="line">select stuname from tb_student where stuid in ( select stuid from tb_record group by stuid having count(stuid)&gt;2 );</span><br><span class="line"></span><br><span class="line">-- 查询学生姓名、课程名称以及成绩(连接查询)</span><br><span class="line">select stuname, couname, score from tb_student t1, tb_course t2, tb_record t3 where stuid&#x3D;sid and couid&#x3D;cid and score is not null;</span><br><span class="line"></span><br><span class="line">-- 查询学生姓名、课程名称以及成绩按成绩从高到低查询第11-15条记录(内连接+分页)</span><br><span class="line">select stuname, couname, score from tb_student inner join tb_record on stuid&#x3D;sid inner join tb_course on couid&#x3D;cid where score is not null order by score desc limit 5 offset 10;</span><br><span class="line"></span><br><span class="line">select stuname, couname, score from tb_student inner join tb_record on stuid&#x3D;sid inner join tb_course on couid&#x3D;cid where score is not null order by score desc limit 10, 5;</span><br><span class="line"></span><br><span class="line">-- 查询选课学生的姓名和平均成绩(子查询和连接查询)</span><br><span class="line">select stuname, avgmark from tb_student, ( select sid, avg(score) as avgmark from tb_record group by sid ) temp where stuid&#x3D;sid;</span><br><span class="line"></span><br><span class="line">select stuname, avgmark from tb_student inner join ( select sid, avg(score) as avgmark from tb_record group by sid ) temp on stuid&#x3D;sid;</span><br><span class="line"></span><br><span class="line">-- 查询每个学生的姓名和选课数量(左外连接和子查询)</span><br><span class="line">select stuname, ifnull(total, 0) from tb_student left outer join ( select sid, count(sid) as total from tb_record group by sid ) temp on stuid&#x3D;sid;</span><br></pre></td></tr></table></figure>

<p>※ DML运算符：</p>
<p>(1).算术运算符（+、-、*、/、%）<br>(2).比较运算符（=、&lt;&gt;、&lt;=&gt;、&lt;、&lt;=、&gt;、&gt;=、BETWEEN…AND…、IN、IS (3).NULL、IS NOT NULL、LIKE、RLIKE、REGEXP）<br>(4).逻辑运算符（NOT、AND、OR、XOR）<br>(5).位运算符（&amp;、|、^、~、&gt;&gt;、&lt;&lt;）</p>
<p>※ DML常用函数：</p>
<p>(1)字符串函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT</td>
<td>将多个字符串连接成一个字符串</td>
</tr>
<tr>
<td>FORMAT</td>
<td>将数值格式化成字符串并指定保留几位小数</td>
</tr>
<tr>
<td>FROM_BASE64 / TO_BASE64</td>
<td>BASE64解码/编码</td>
</tr>
<tr>
<td>BIN / OCT / HEX</td>
<td>将数值转换成二进制/八进制/十六进制字符串</td>
</tr>
<tr>
<td>LOCATE</td>
<td>在字符串中查找一个子串的位置</td>
</tr>
<tr>
<td>LEFT / RIGHT</td>
<td>返回一个字符串左边/右边指定长度的字符</td>
</tr>
<tr>
<td>LENGTH / CHAR_LENGTH</td>
<td>返回字符串的长度以字节/字符为单位</td>
</tr>
<tr>
<td>LOWER / UPPER</td>
<td>返回字符串的小写/大写形式</td>
</tr>
<tr>
<td>LPAD / RPAD</td>
<td>如果字符串的长度不足，在字符串左边/右边填充指定的字符</td>
</tr>
<tr>
<td>LTRIM / RTRIM</td>
<td>去掉字符串前面/后面的空格</td>
</tr>
<tr>
<td>ORD / CHAR</td>
<td>返回字符对应的编码/返回编码对应的字符</td>
</tr>
<tr>
<td>STRCMP</td>
<td>比较字符串，返回-1、0、1分别表示小于、等于、大于</td>
</tr>
<tr>
<td>SUBSTRING</td>
<td>返回字符串指定范围的子串</td>
</tr>
</tbody></table>
<p>(2).数值函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>ABS</td>
<td>返回一个数的绝度值</td>
</tr>
<tr>
<td>CEILING / FLOOR</td>
<td>返回一个数上取整/下取整的结果</td>
</tr>
<tr>
<td>CONV</td>
<td>将一个数从一种进制转换成另一种进制</td>
</tr>
<tr>
<td>CRC32</td>
<td>计算循环冗余校验码</td>
</tr>
<tr>
<td>EXP / LOG / LOG2 / LOG10</td>
<td>计算指数/对数</td>
</tr>
<tr>
<td>POW</td>
<td>求幂</td>
</tr>
<tr>
<td>RAND</td>
<td>返回[0,1)范围的随机数</td>
</tr>
<tr>
<td>ROUND</td>
<td>返回一个数四舍五入后的结果</td>
</tr>
<tr>
<td>SQRT</td>
<td>返回一个数的平方根</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>截断一个数到指定的精度</td>
</tr>
<tr>
<td>SIN / COS / TAN / COT / ASIN / ACOS / ATAN</td>
<td>三角函数</td>
</tr>
</tbody></table>
<p>(3).时间日期函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE / CURTIME / NOW</td>
<td>获取当前日期/时间/日期和时间</td>
</tr>
<tr>
<td>ADDDATE / SUBDATE</td>
<td>将两个日期表达式相加/相减并返回结果</td>
</tr>
<tr>
<td>DATE / TIME</td>
<td>从字符串中获取日期/时间</td>
</tr>
<tr>
<td>YEAR / MONTH / DAY</td>
<td>从日期中获取年/月/日</td>
</tr>
<tr>
<td>HOUR / MINUTE / SECOND</td>
<td>从时间中获取时/分/秒</td>
</tr>
<tr>
<td>DATEDIFF / TIMEDIFF</td>
<td>返回两个时间日期表达式相差多少天/小时</td>
</tr>
<tr>
<td>MAKEDATE / MAKETIME</td>
<td>制造一个日期/时间</td>
</tr>
</tbody></table>
<p>(4).流程函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>IF</td>
<td>根据条件是否成立返回不同的值</td>
</tr>
<tr>
<td>IFNULL</td>
<td>如果为NULL则返回指定的值否则就返回本身</td>
</tr>
<tr>
<td>NULLIF</td>
<td>两个表达式相等就返回NULL否则返回第一个表达式的值</td>
</tr>
</tbody></table>
<p>(5).其他函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>MD5 / SHA1 / SHA2</td>
<td>返回字符串对应的哈希摘要</td>
</tr>
<tr>
<td>CHARSET / COLLATION</td>
<td>返回字符集/校对规则</td>
</tr>
<tr>
<td>USER / CURRENT_USER</td>
<td>返回当前用户</td>
</tr>
<tr>
<td>DATABASE</td>
<td>返回当前数据库名</td>
</tr>
<tr>
<td>VERSION</td>
<td>返回当前数据库版本</td>
</tr>
<tr>
<td>FOUND_ROWS / ROW_COUNT</td>
<td>返回查询到的行数/受影响的行数</td>
</tr>
<tr>
<td>LAST_INSERT_ID</td>
<td>返回最后一个自增主键的值</td>
</tr>
<tr>
<td>UUID / UUID_SHORT</td>
<td>返回全局唯一标识符</td>
</tr>
</tbody></table>
<h4 id="（3）-数据控制语言-Data-Control-Language"><a href="#（3）-数据控制语言-Data-Control-Language" class="headerlink" title="（3）.数据控制语言 (Data Control Language)"></a>（3）.数据控制语言 (Data Control Language)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 创建可以远程登录的root账号并为其指定口令</span><br><span class="line">create user &#39;root&#39;@&#39;%&#39; identified by &#39;123456&#39;;</span><br><span class="line"></span><br><span class="line">-- 为远程登录的root账号授权操作所有数据库所有对象的所有权限并允许其将权限再次赋予其他用户</span><br><span class="line">grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; with grant option;</span><br><span class="line"></span><br><span class="line">-- 创建名为hellokitty的用户并为其指定口令</span><br><span class="line">create user &#39;hellokitty&#39;@&#39;%&#39; identified by &#39;123123&#39;;</span><br><span class="line"></span><br><span class="line">-- 将对school数据库所有对象的所有操作权限授予hellokitty</span><br><span class="line">grant all privileges on school.* to &#39;hellokitty&#39;@&#39;%&#39;;</span><br><span class="line"></span><br><span class="line">-- 召回hellokitty对school数据库所有对象的insert&#x2F;delete&#x2F;update权限</span><br><span class="line">revoke insert, delete, update on school.* from &#39;hellokitty&#39;@&#39;%&#39;;</span><br></pre></td></tr></table></figure>

<h3 id="2-索引"><a href="#2-索引" class="headerlink" title="2.索引"></a>2.索引</h3><p>MySQL中，所有数据类型的列都可以被索引，常用的存储引擎InnoDB和MyISAM能支持每个表创建16个索引。InnoDB和MyISAM使用的索引其底层算法是B-tree（B树），B-tree是一种自平衡的树，类似于平衡二叉排序树，能够保持数据有序。这种数据结构能够让查找数据、顺序访问、插入数据及删除的操作都在对数时间内完成。</p>
<p>例1.使用explain关键字查看SQL执行查询过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_student where stuname&#x3D;&#39;林震南&#39;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: tb_student</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 11</span><br><span class="line">     filtered: 10.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">1.type：MySQL在表中找到满足条件的行的方式，也称为访问类型，包括：ALL（全表扫描）、index（索引全扫描）、range（索引范围扫描）、ref（非唯一索引扫描）、eq_ref（唯一索引扫描）、const&#x2F;system、NULL。在所有的访问类型中，很显然ALL是性能最差的，它代表了全表扫描是指要扫描表中的每一行才能找到匹配的行。</span><br><span class="line">2.possible_keys：MySQL可以选择的索引，但是有可能不会使用。</span><br><span class="line">3.key：MySQL真正使用的索引。</span><br><span class="line">4.rows：执行查询需要扫描的行数，这是一个预估值。</span><br></pre></td></tr></table></figure>

<p>为上述查询过程添加索引实现加速查询速度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_student_name on tb_student(stuname);</span><br></pre></td></tr></table></figure>

<p>再次查看SQL查询过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: tb_student</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_student_name</span><br><span class="line">          key: idx_student_name</span><br><span class="line">      key_len: 62</span><br><span class="line">          ref: const</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>MySQL还支持前缀索引，即对索引字段的前N个字符创建索引，这样的话可以减少索引占用的空间（但节省了空间很有可能会浪费时间，时间和空间是不可调和的矛盾），以下例子以第一个字符作为前缀索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_student_name_1 on tb_student(stuname(1));</span><br></pre></td></tr></table></figure>

<p>同样实现优化过程，减少索引的存储空间，但是可能查询速度会有所下降。</p>
<p>删除索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_student drop index idx_student_name;</span><br><span class="line">-- 或者</span><br><span class="line">drop index idx_student_name on tb_student;</span><br></pre></td></tr></table></figure>

<p>索引的设计原则：</p>
<ol>
<li>最适合索引的列是出现在WHERE子句和连接子句中的列。</li>
<li>索引列的基数越大（取值多重复值少），索引的效果就越好。</li>
<li>使用<strong>前缀索引</strong>可以减少索引占用的空间，内存中可以缓存更多的索引。</li>
<li>索引不是越多越好，虽然索引加速了读操作（查询），但是写操作（增、删、改）都会变得更慢，因为数据的变化会导致索引的更新，就如同书籍章节的增删需要更新目录一样。</li>
<li>使用InnoDB存储引擎时，表的普通索引都会保存主键的值，所以<strong>主键要尽可能选择较短的数据类型</strong>，这样可以有效的减少索引占用的空间，利用提升索引的缓存效果。</li>
</ol>
<h3 id="3-视图"><a href="#3-视图" class="headerlink" title="3.视图"></a>3.视图</h3><p>视图就是虚拟的表，但与数据表不同的是，数据表是一种实体结构，而视图是一种虚拟结构，你也可以将视图理解为保存在数据库中被赋予名字的SQL语句。</p>
<p>使用视图可以获得以下好处：</p>
<ol>
<li>可以将实体数据表隐藏起来，让外部程序无法得知实际的数据结构，让访问者可以使用表的组成部分而不是整个表，降低数据库被攻击的风险。</li>
<li>在大多数的情况下视图是只读的（更新视图的操作通常都有诸多的限制），外部程序无法直接透过视图修改数据。</li>
<li>重用SQL语句，将高度复杂的查询包装在视图表中，直接访问该视图即可取出需要的数据；也可以将视图视为数据表进行连接查询。</li>
<li>视图可以返回与实体数据表不同格式的数据。</li>
</ol>
<h4 id="（1）创建视图"><a href="#（1）创建视图" class="headerlink" title="（1）创建视图"></a>（1）创建视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create view vw_avg_score </span><br><span class="line">as </span><br><span class="line">    select sid, round(avg(score), 1) as avgscore </span><br><span class="line">    from tb_record group by sid;</span><br><span class="line"></span><br><span class="line">create view vw_student_score </span><br><span class="line">as </span><br><span class="line">    select stuname, avgscore </span><br><span class="line">    from tb_student, vw_avg_score </span><br><span class="line">    where stuid&#x3D;sid;</span><br></pre></td></tr></table></figure>

<h4 id="（2）使用视图"><a href="#（2）使用视图" class="headerlink" title="（2）使用视图"></a>（2）使用视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select stuname, avgscore from vw_student_score order by avgscore desc;</span><br><span class="line"></span><br><span class="line">+--------------+----------+</span><br><span class="line">| stuname      | avgscore |</span><br><span class="line">+--------------+----------+</span><br><span class="line">| 杨过         |     95.6 |</span><br><span class="line">| 任我行       |     53.5 |</span><br><span class="line">| 王语嫣       |     84.3 |</span><br><span class="line">| 纪嫣然       |     73.8 |</span><br><span class="line">| 岳不群       |     78.0 |</span><br><span class="line">| 东方不败     |     88.0 |</span><br><span class="line">| 项少龙       |     92.0 |</span><br><span class="line">+--------------+----------+</span><br></pre></td></tr></table></figure>

<p>视图的可更新性要视具体情况而定，以下类型的视图是不能更新的：</p>
<ol>
<li>使用了聚合函数（SUM、MIN、MAX、AVG、COUNT等）、DISTINCT、GROUP BY、HAVING、UNION或者UNION ALL的视图。</li>
<li>SELECT中包含了子查询的视图。</li>
<li>FROM子句中包含了一个不能更新的视图的视图。</li>
<li>WHERE子句的子查询引用了FROM子句中的表的视图。</li>
</ol>
<h4 id="（3）删除视图"><a href="#（3）删除视图" class="headerlink" title="（3）删除视图"></a>（3）删除视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view vw_student_score;</span><br></pre></td></tr></table></figure>

<p>视图的规则和限制</p>
<ol>
<li>视图可以嵌套，可以利用从其他视图中检索的数据来构造一个新的视图。视图也可以和表一起使用。</li>
<li>创建视图时可以使用<code>order by</code>子句，但如果从视图中检索数据时也使用了<code>order by</code>，那么该视图中原先的<code>order by</code>会被覆盖。</li>
<li>视图无法使用索引，也不会激发触发器（实际开发中因为性能等各方面的考虑，通常不建议使用触发器，所以我们也不对这个概念进行介绍）的执行。</li>
</ol>
<h3 id="4-存储过程"><a href="#4-存储过程" class="headerlink" title="4.存储过程"></a>4.存储过程</h3><p>存储过程是事先编译好存储在数据库中的一组SQL的集合，调用存储过程可以简化应用程序开发人员的工作，减少与数据库服务器之间的通信，对于提升数据操作的性能也是有帮助的。其实迄今为止，我们使用的SQL语句都是针对一个或多个表的单条语句，但在实际开发中经常会遇到某个操作需要多条SQL语句才能完成的情况。例如，电商网站在受理用户订单时，需要做以下一系列的处理。</p>
<ol>
<li>通过查询来核对库存中是否有对应的物品以及库存是否充足。</li>
<li>如果库存有物品，需要锁定库存以确保这些物品不再卖给别人， 并且要减少可用的物品数量以反映正确的库存量。</li>
<li>如果库存不足，可能需要进一步与供应商进行交互或者至少产生一条系统提示消息。</li>
<li>不管受理订单是否成功，都需要产生流水记录，而且需要给对应的用户产生一条通知信息。</li>
</ol>
<p>我们可以通过存储过程将复杂的操作封装起来，这样不仅有助于保证数据的一致性，而且将来如果业务发生了变动，只需要调整和修改存储过程即可。对于调用存储过程的用户来说，存储过程并没有暴露数据表的细节，而且执行存储过程比一条条的执行一组SQL要快得多。</p>
<p>下面的存储过程实现了查询某门课程的最高分、最低分和平均分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists sp_score_by_cid;</span><br><span class="line"></span><br><span class="line">delimiter $$</span><br><span class="line"></span><br><span class="line">create procedure sp_score_by_cid(</span><br><span class="line">	courseId int, </span><br><span class="line">	out maxScore decimal(4,1), </span><br><span class="line">	out minScore decimal(4,1),</span><br><span class="line">	out avgScore decimal(4,1)</span><br><span class="line">)</span><br><span class="line">begin</span><br><span class="line">	select max(score) into maxScore from tb_record </span><br><span class="line">		where cid&#x3D;courseId;</span><br><span class="line">	select min(score) into minScore from tb_record </span><br><span class="line">		where cid&#x3D;courseId;</span><br><span class="line">	select avg(score) into avgScore from tb_record </span><br><span class="line">		where cid&#x3D;courseId;</span><br><span class="line">end $$</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line">call sp_score_by_cid(1111, @a, @b, @c);</span><br><span class="line">select @a, @b, @c;</span><br></pre></td></tr></table></figure>

<p>说明：在定义存储过程时，因为可能需要书写多条SQL，而分隔这些SQL需要使用分号作为分隔符，如果这个时候，仍然用分号表示整段代码结束，那么定义存储过程的SQL就会出现错误，所以上面我们用<code>delimiter $$</code>将整段代码结束的标记定义为<code>$$</code>，那么代码中的分号将不再表示整段代码的结束，需要马上执行，整段代码在遇到<code>end $$</code>时才输入完成并执行。在定义完存储过程后，通过<code>delimiter ;</code>将结束符重新改回成分号。</p>
<p>上面定义的存储过程有四个参数，其中第一个参数是输入参数，代表课程的编号，后面的参数都是输出参数，因为存储过程不能定义返回值，只能通过输出参数将执行结果带出，定义输出参数的关键字是<code>out</code>，默认情况下参数都是输入参数。</p>
<h4 id="（1）调用存储过程。"><a href="#（1）调用存储过程。" class="headerlink" title="（1）调用存储过程。"></a>（1）调用存储过程。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call sp_score_by_cid(1111, @a, @b, @c);</span><br></pre></td></tr></table></figure>

<h4 id="（2）获取输出参数的值。"><a href="#（2）获取输出参数的值。" class="headerlink" title="（2）获取输出参数的值。"></a>（2）获取输出参数的值。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @a as 最高分, @b as 最低分, @c as 平均分;</span><br></pre></td></tr></table></figure>

<h4 id="（3）删除存储过程。"><a href="#（3）删除存储过程。" class="headerlink" title="（3）删除存储过程。"></a>（3）删除存储过程。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure sp_score_by_cid;</span><br></pre></td></tr></table></figure>

<p>在存储过程中，我们可以定义变量、条件，可以使用分支和循环语句，可以通过游标操作查询结果，还可以使用事件调度器，这些内容我们暂时不在此处进行介绍。虽然我们说了很多存储过程的好处，但是在实际开发中，如果过度的使用存储过程，将大量复杂的运算放到存储过程中，也会导致占用数据库服务器的CPU资源，造成数据库服务器承受巨大的压力。为此，我们一般会将复杂的运算和处理交给应用服务器，因为很容易部署多台应用服务器来分摊这些压力。</p>
<h3 id="5-范式"><a href="#5-范式" class="headerlink" title="5.范式"></a>5.范式</h3><ol>
<li>第一范式：数据表的每个列的值域都是由原子值组成的，不能够再分割。</li>
<li>第二范式：数据表里的所有数据都要和该数据表的键（主键与候选键）有完全依赖关系。</li>
<li>第三范式：所有非键属性都只和候选键有相关性，也就是说非键属性之间应该是独立无关的。</li>
</ol>
<h3 id="6-数据完整性"><a href="#6-数据完整性" class="headerlink" title="6.数据完整性"></a>6.数据完整性</h3><h4 id="（1）实体完整性"><a href="#（1）实体完整性" class="headerlink" title="（1）实体完整性"></a>（1）实体完整性</h4><p>每个实体都是独一无二的</p>
<ul>
<li>主键（primary key） / 唯一约束 / 唯一索引（unique）</li>
</ul>
<h4 id="（2）引用完整性（参照完整性）"><a href="#（2）引用完整性（参照完整性）" class="headerlink" title="（2）引用完整性（参照完整性）"></a>（2）引用完整性（参照完整性）</h4><p>关系中不允许引用不存在的实体</p>
<ul>
<li>外键（foreign key）</li>
</ul>
<h4 id="（3）域完整性-数据是有效的"><a href="#（3）域完整性-数据是有效的" class="headerlink" title="（3）域完整性 - 数据是有效的"></a>（3）域完整性 - 数据是有效的</h4><ul>
<li><p>数据类型及长度</p>
</li>
<li><p>非空约束（not null）</p>
</li>
<li><p>默认值约束（default）</p>
</li>
<li><p>检查约束（check）</p>
</li>
</ul>
<p>说明：在MySQL数据库中，检查约束并不起作用。</p>
<h3 id="7-数据一致性"><a href="#7-数据一致性" class="headerlink" title="7.数据一致性"></a>7.数据一致性</h3><ol>
<li><p>事务：一系列对数据库进行读/写的操作，这些操作要么全都成功，要么全都失败。</p>
</li>
<li><p>事务的ACID特性</p>
<ul>
<li>原子性：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行</li>
<li>一致性：事务应确保数据库的状态从一个一致状态转变为另一个一致状态</li>
<li>隔离性：多个事务并发执行时，一个事务的执行不应影响其他事务的执行</li>
<li>持久性：已被提交的事务对数据库的修改应该永久保存在数据库中</li>
</ul>
</li>
<li><p>MySQL中的事务操作</p>
<h4 id="（1）开启事务环境"><a href="#（1）开启事务环境" class="headerlink" title="（1）开启事务环境"></a>（1）开启事务环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start transaction</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br></pre></td></tr></table></figure>

<h4 id="（2）提交事务"><a href="#（2）提交事务" class="headerlink" title="（2）提交事务"></a>（2）提交事务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commit</span><br></pre></td></tr></table></figure>

<h4 id="（3）回滚事务"><a href="#（3）回滚事务" class="headerlink" title="（3）回滚事务"></a>（3）回滚事务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rollback</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="8-Python数据库编程"><a href="#8-Python数据库编程" class="headerlink" title="8.Python数据库编程"></a>8.Python数据库编程</h3><h4 id="（1）安装PyMySQL"><a href="#（1）安装PyMySQL" class="headerlink" title="（1）安装PyMySQL"></a>（1）安装PyMySQL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure>

<h4 id="（2）添加一个部门"><a href="#（2）添加一个部门" class="headerlink" title="（2）添加一个部门"></a>（2）添加一个部门</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">   </span><br><span class="line">def main():</span><br><span class="line">       no &#x3D; int(input(&#39;编号: &#39;))</span><br><span class="line">       name &#x3D; input(&#39;名字: &#39;)</span><br><span class="line">       loc &#x3D; input(&#39;所在地: &#39;)</span><br><span class="line">       # 1. 创建数据库连接对象</span><br><span class="line">       con &#x3D; pymysql.connect(host&#x3D;&#39;localhost&#39;, port&#x3D;3306,</span><br><span class="line">                             database&#x3D;&#39;hrs&#39;, charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">                             user&#x3D;&#39;yourname&#39;, password&#x3D;&#39;yourpass&#39;)</span><br><span class="line">    try:</span><br><span class="line">           # 2. 通过连接对象获取游标</span><br><span class="line">           with con.cursor() as cursor:</span><br><span class="line">               # 3. 通过游标执行SQL并获得执行结果</span><br><span class="line">               result &#x3D; cursor.execute(</span><br><span class="line">                   &#39;insert into tb_dept values (%s, %s, %s)&#39;,</span><br><span class="line">                   (no, name, loc)</span><br><span class="line">               )</span><br><span class="line">           if result &#x3D;&#x3D; 1:</span><br><span class="line">               print(&#39;添加成功!&#39;)</span><br><span class="line">           # 4. 操作成功提交事务</span><br><span class="line">           con.commit()</span><br><span class="line">     finally:</span><br><span class="line">           # 5. 关闭连接释放资源</span><br><span class="line">           con.close()</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h4 id="（3）删除一个部门"><a href="#（3）删除一个部门" class="headerlink" title="（3）删除一个部门"></a>（3）删除一个部门</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    no &#x3D; int(input(&#39;编号: &#39;))</span><br><span class="line">    con &#x3D; pymysql.connect(host&#x3D;&#39;localhost&#39;, port&#x3D;3306,</span><br><span class="line">                          database&#x3D;&#39;hrs&#39;, charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">                          user&#x3D;&#39;yourname&#39;, password&#x3D;&#39;yourpass&#39;,</span><br><span class="line">                          autocommit&#x3D;True)</span><br><span class="line">    try:</span><br><span class="line">        with con.cursor() as cursor:</span><br><span class="line">            result &#x3D; cursor.execute(</span><br><span class="line">                &#39;delete from tb_dept where dno&#x3D;%s&#39;,</span><br><span class="line">                (no, )</span><br><span class="line">            )</span><br><span class="line">        if result &#x3D;&#x3D; 1:</span><br><span class="line">            print(&#39;删除成功!&#39;)</span><br><span class="line">    finally:</span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>说明：如果不希望每次SQL操作之后手动提交或回滚事务，可以像上面的代码那样，在创建连接的时候多加一个名为<code>autocommit</code>的参数并将它的值设置为<code>True</code>，表示每次执行SQL之后自动提交。如果程序中不需要使用事务环境也不希望手动的提交或回滚就可以这么做。</p>
<h4 id="（4）更新一个部门"><a href="#（4）更新一个部门" class="headerlink" title="（4）更新一个部门"></a>（4）更新一个部门</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    no &#x3D; int(input(&#39;编号: &#39;))</span><br><span class="line">    name &#x3D; input(&#39;名字: &#39;)</span><br><span class="line">    loc &#x3D; input(&#39;所在地: &#39;)</span><br><span class="line">    con &#x3D; pymysql.connect(host&#x3D;&#39;localhost&#39;, port&#x3D;3306,</span><br><span class="line">                          database&#x3D;&#39;hrs&#39;, charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">                          user&#x3D;&#39;yourname&#39;, password&#x3D;&#39;yourpass&#39;,</span><br><span class="line">                          autocommit&#x3D;True)</span><br><span class="line">    try:</span><br><span class="line">        with con.cursor() as cursor:</span><br><span class="line">            result &#x3D; cursor.execute(</span><br><span class="line">                &#39;update tb_dept set dname&#x3D;%s, dloc&#x3D;%s where dno&#x3D;%s&#39;,</span><br><span class="line">                (name, loc, no)</span><br><span class="line">            )</span><br><span class="line">        if result &#x3D;&#x3D; 1:</span><br><span class="line">            print(&#39;更新成功!&#39;)</span><br><span class="line">    finally:</span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h4 id="（5）查询所有部门"><a href="#（5）查询所有部门" class="headerlink" title="（5）查询所有部门"></a>（5）查询所有部门</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from pymysql.cursors import DictCursor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    con &#x3D; pymysql.connect(host&#x3D;&#39;localhost&#39;, port&#x3D;3306,</span><br><span class="line">                          database&#x3D;&#39;hrs&#39;, charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">                          user&#x3D;&#39;yourname&#39;, password&#x3D;&#39;yourpass&#39;)</span><br><span class="line">    try:</span><br><span class="line">        with con.cursor(cursor&#x3D;DictCursor) as cursor:</span><br><span class="line">            cursor.execute(&#39;select dno as no, dname as name, dloc as loc from tb_dept&#39;)</span><br><span class="line">            results &#x3D; cursor.fetchall()</span><br><span class="line">            print(results)</span><br><span class="line">            print(&#39;编号\t名称\t\t所在地&#39;)</span><br><span class="line">            for dept in results:</span><br><span class="line">                print(dept[&#39;no&#39;], end&#x3D;&#39;\t&#39;)</span><br><span class="line">                print(dept[&#39;name&#39;], end&#x3D;&#39;\t&#39;)</span><br><span class="line">                print(dept[&#39;loc&#39;])</span><br><span class="line">    finally:</span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h4 id="（6）分页查询员工信息"><a href="#（6）分页查询员工信息" class="headerlink" title="（6）分页查询员工信息"></a>（6）分页查询员工信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from pymysql.cursors import DictCursor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Emp(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, no, name, job, sal):</span><br><span class="line">        self.no &#x3D; no</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.job &#x3D; job</span><br><span class="line">        self.sal &#x3D; sal</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return f&#39;\n编号：&#123;self.no&#125;\n姓名：&#123;self.name&#125;\n职位：&#123;self.job&#125;\n月薪：&#123;self.sal&#125;\n&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    page &#x3D; int(input(&#39;页码: &#39;))</span><br><span class="line">    size &#x3D; int(input(&#39;大小: &#39;))</span><br><span class="line">    con &#x3D; pymysql.connect(host&#x3D;&#39;localhost&#39;, port&#x3D;3306,</span><br><span class="line">                          database&#x3D;&#39;hrs&#39;, charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">                          user&#x3D;&#39;yourname&#39;, password&#x3D;&#39;yourpass&#39;)</span><br><span class="line">    try:</span><br><span class="line">        with con.cursor() as cursor:</span><br><span class="line">            cursor.execute(</span><br><span class="line">                &#39;select eno as no, ename as name, job, sal from tb_emp limit %s,%s&#39;,</span><br><span class="line">                ((page - 1) * size, size)</span><br><span class="line">            )</span><br><span class="line">            for emp_tuple in cursor.fetchall():</span><br><span class="line">                emp &#x3D; Emp(*emp_tuple)</span><br><span class="line">                print(emp)</span><br><span class="line">    finally:</span><br><span class="line">        con.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="9-存储过程（Stored-Procedure）"><a href="#9-存储过程（Stored-Procedure）" class="headerlink" title="9.存储过程（Stored Procedure）"></a>9.存储过程（Stored Procedure）</h3><p>存储过程是一种在数据库中存储复杂程序，以便外部程序调用的一种数据库对象。</p>
<p>存储过程是为了完成特定功能的SQL语句集，经编译创建并保存在数据库中，用户可通过指定存储过程的名字并给定参数(需要时)来调用执行。</p>
<h4 id="（1）存储与函数的区别"><a href="#（1）存储与函数的区别" class="headerlink" title="（1）存储与函数的区别"></a>（1）存储与函数的区别</h4><p>1.一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。      </p>
<p>2.对于存储过程来说可以返回参数(output)，而函数只能返回值或者表对象。      </p>
<p>3.存储过程一般是作为一个独立的部分来执行，而函数可以作为查询语句的一个部分来调用，由于函数可以返回一个表对象，因此它可以在查询语句中位于FROM关键字的后面。   </p>
<h4 id="（2）存储过程的优缺点"><a href="#（2）存储过程的优缺点" class="headerlink" title="（2）存储过程的优缺点"></a>（2）存储过程的优缺点</h4><p>优点：</p>
<p>(1)重复使用。存储过程可以重复使用，从而可以减少数据库开发人员的工作量。</p>
<p>(2)提高性能。存储过程在创建的时候就进行了编译，将来使用的时候不用再重新编译。一般的SQL语句每执行一次就需要编译一次，所以使用存储过程提高了效率。</p>
<p>(3)减少网络流量。存储过程位于服务器上，调用的时候只需要传递存储过程的名称以及参数就可以了，因此降低了网络传输的数据量。</p>
<p>(4)安全性。参数化的存储过程可以防止SQL注入式的攻击，而且可以将Grant、Deny以及Revoke权限应用于存储过程。</p>
<p>缺点：</p>
<p>存储过程的性能调校与撰写，受限于各种数据库系统。</p>
<h4 id="（3）常用系统存储过程"><a href="#（3）常用系统存储过程" class="headerlink" title="（3）常用系统存储过程"></a>（3）常用系统存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exec sp_databases; --查看数据库</span><br><span class="line">exec sp_tables;        --查看表</span><br><span class="line">exec sp_columns student;--查看列</span><br><span class="line">exec sp_helpIndex student;--查看索引</span><br><span class="line">exec sp_helpConstraint student;--约束</span><br><span class="line">exec sp_stored_procedures;</span><br><span class="line">exec sp_helptext &#39;sp_stored_procedures&#39;;--查看存储过程创建、定义语句 经常用到这句话来查看存储过程，like sp_helptext sp_getLoginInfo.</span><br><span class="line">exec sp_rename student, stuInfo;--修改表、索引、列的名称</span><br><span class="line">exec sp_renamedb myTempDB, myDB;--更改数据库名称</span><br><span class="line">exec sp_defaultdb &#39;master&#39;, &#39;myDB&#39;;--更改登录名的默认数据库</span><br><span class="line">exec sp_helpdb;--数据库帮助，查询数据库信息</span><br><span class="line">exec sp_helpdb master;</span><br><span class="line">（系统存储过程一般以sp开头，用户自定义的存储过程一般以usp开头）</span><br></pre></td></tr></table></figure>

<h4 id="（4）创建-amp-调用存储过程"><a href="#（4）创建-amp-调用存储过程" class="headerlink" title="（4）创建&amp;调用存储过程"></a>（4）创建&amp;调用存储过程</h4><h5 id="4-1显示平均价格的存储过程"><a href="#4-1显示平均价格的存储过程" class="headerlink" title="4.1显示平均价格的存储过程"></a>4.1<strong>显示</strong>平均价格的存储过程</h5><p>过程名为productpricing</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE productpricing()</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT Avg(prod_price) AS priceaverage</span><br><span class="line">    FROM products;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL productpricing();</span><br></pre></td></tr></table></figure>

<h5 id="4-2返回平均值、最小-大值结果"><a href="#4-2返回平均值、最小-大值结果" class="headerlink" title="4.2返回平均值、最小/大值结果"></a>4.2返回<strong>平均值、最小/大值</strong>结果</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE productpricing(</span><br><span class="line">    OUT pl DECIMAL(8,2),</span><br><span class="line">    OUT ph DECIMAL(8,2),</span><br><span class="line">    OUT pa DECIMAL(8,2)</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT Min(prod_price)</span><br><span class="line">    INTO pl</span><br><span class="line">    FROM products;</span><br><span class="line">    SELECT Max(prod_price)</span><br><span class="line">    INTO ph</span><br><span class="line">    FROM products;</span><br><span class="line">    SELECT Avg(prod_price)</span><br><span class="line">    INTO pa</span><br><span class="line">    FROM products;</span><br><span class="line">END;</span><br><span class="line">分析：此存储过程接受3个参数：pl存储产品最低价格，ph存储产品最高价格，pa存储产品平均价格。每个参数必须具有指定的类型，这里使用十进制。关键字OUT指出相应的参数用来从存储过程传出一个值（返回给调用者）。MySQL支持IN（传递给存储过程）、OUT（从存储过程传出，如这里所用）和INOUT（对存储过程传入和传出）类型的参数。存储过程的代码位于BEGIN和END语句内，如前所见，它们是一系列SELECT语句，用来检查值，然后保存到相应的变量（通过INTO关键字）。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CALL productpricing(@pricelow,</span><br><span class="line">                    @pricehigh,</span><br><span class="line">                    @priceaverage);</span><br></pre></td></tr></table></figure>

<p>显示上述平均价格：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @priceaverage;</span><br></pre></td></tr></table></figure>

<h5 id="4-3带有形参的返回"><a href="#4-3带有形参的返回" class="headerlink" title="4.3带有形参的返回"></a>4.3带有形参的返回</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE ordertotal(</span><br><span class="line">    IN onumber INT,</span><br><span class="line">    OUT ototal DECIMAL(8,2)</span><br><span class="line">)</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT Sum(item_price*quantity)</span><br><span class="line">    FROM orderitems</span><br><span class="line">    WHERE order_num &#x3D; onumber</span><br><span class="line">    INTO ototal;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 调用</span><br><span class="line">CALL ordertotal(20005,@total);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 显示</span><br><span class="line">SELECT @total;</span><br></pre></td></tr></table></figure>

<h4 id="（6）删除存储过程"><a href="#（6）删除存储过程" class="headerlink" title="（6）删除存储过程"></a>（6）删除存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE productpricing</span><br></pre></td></tr></table></figure>

<h4 id="（7）复杂存储过程"><a href="#（7）复杂存储过程" class="headerlink" title="（7）复杂存储过程"></a>（7）复杂存储过程</h4><ul>
<li>获得合计；</li>
<li>把营业税有条件地添加到合计；</li>
<li>返回合计（带或不带税）。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE ordertotal(</span><br><span class="line">    IN onumber INT,</span><br><span class="line">    IN taxable BOOLEAN,</span><br><span class="line">    OUT ototal DECIMAL(8,2)</span><br><span class="line">)COMMENT &#39;Obtain order total,optionally adding tax&#39;</span><br><span class="line">BEGIN</span><br><span class="line">    -- Declare variable for total</span><br><span class="line">    DECLARE total DECIMAL(8,2);</span><br><span class="line">    -- Declare tax percentage</span><br><span class="line">    DECLARE taxrate INT DEFAULT 6;</span><br><span class="line">    </span><br><span class="line">    --Get the order toal</span><br><span class="line">    SELECT Sum(item_price*quantity)</span><br><span class="line">    FROM orderitems</span><br><span class="line">    WHERE order_num &#x3D; onumber</span><br><span class="line">    INTO total;</span><br><span class="line">    </span><br><span class="line">    -- Is this taxable?</span><br><span class="line">    IF taxable THEN</span><br><span class="line">        -- Yes,so add taxrate to the total</span><br><span class="line">        SELECT total+(total&#x2F;100*taxrate) INTO total;</span><br><span class="line">    END IF;</span><br><span class="line">    </span><br><span class="line">    -- And finally, save to out variable</span><br><span class="line">    SELECT total INTO ototal;</span><br><span class="line">    </span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>分析：</p>
<p>1.增加注释（前面放置–)。</p>
<p>2.添加另外一个参数<strong>taxable</strong>，它是一个布尔值（如果要增加税则为真，否则为假）。</p>
<p>3.用<strong>DECLARE</strong>要求指定变量名和数据类型，它也支持可选的默认值（这个例子中的<strong>taxrate</strong>的默认被设置成6%）。</p>
<p>4.<strong>SELECT</strong>语句已经改变，因此其结果存储到<strong>total</strong>（局部变量）而不是ototal。</p>
<p>5.<strong>IF</strong>语句检查<strong>taxable</strong>是否为真，如果为真，则用另一<strong>SELECT</strong>语句增加营业税到局部变量<strong>total</strong>。最后，用另一个<strong>SELECT</strong>语句将<strong>total</strong>（它增加或许不增加营业税）保存到<strong>ototal</strong>。</p>
<p>6.<strong>COMMENT关键字</strong>  本例子中的存储过程在<strong>CREATE PROCEDURE</strong>语句中包含了一个<strong>COMMENT</strong>值。它不是必须的，但如果给出，将在<strong>SHWO PROCEDURE STATUS</strong>的结果中显示。</p>
<p>调用和显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CALL ordertotal(20005,0,@total);</span><br><span class="line">SELECT @total;</span><br></pre></td></tr></table></figure>

<h4 id="（8）检查存储过程"><a href="#（8）检查存储过程" class="headerlink" title="（8）检查存储过程"></a>（8）检查存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE PROCEDURE ordertotal;</span><br></pre></td></tr></table></figure>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>索引的优势：</p>
<p>a. 可以提高数据检索的效率，降低数据库的IO成本，类似于书的目录。</p>
<p>b. 通过索引列对数据进行排序，降低数据排序的成本，降低了CPU的消耗。</p>
<p>索引的劣势：</p>
<p>a. 索引会占据磁盘空间。</p>
<p>b. 索引虽然会提高查询效率，但是会降低更新表的效率。比如每次对表进行增删改操作，MySQL不仅要保存数据，还有保存或者更新对应的索引文件。</p>
<p>索引的数据结构：</p>
<p>mysql在数据库设计时有，Hash、B+树 两种类型可以选择。选择使用依据及常用场景：</p>
<p>Hash，由于hash表特点使用Hash索引，可以快速的精确查询，但不支持范围查询。常用于等值查询场景(只有key-value的情况)，如redis，memcached等这些Nosql的中间键。</p>
<p>创建索引应遵循的原则</p>
<p>索引是提高效率的一个因素，因此在建立索引的时候应该遵循以下原则：</p>
<ol>
<li>在经常需要搜索的列上建立索引，可以在经常使用 WHERE 子句的列上创建索引可以加快搜索的速度。</li>
<li>在作为主键的列上创建索引，强制该列的唯一性，并组织表中数据的排列结构。</li>
<li>在经常使用表连接的列上创建索引，这些列主要是一些外键，可以加快表连接的速度。</li>
<li>在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，所以其指定的范围是连续的。</li>
<li>在经常需要排序的列上创建索引，因为索引已经排序，所以查询时可以利用索引的排序，加快排序查询。</li>
</ol>
<p>索引优化</p>
<ul>
<li>独立的列</li>
</ul>
<p>在进行查询时，索引列不能是表达式的一部分，也不能是函数的参数，否则无法使用索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT actor_id FROM sakila.actor WHERE actor_id + 1 &#x3D; 5;</span><br></pre></td></tr></table></figure>

<ul>
<li>联合索引</li>
</ul>
<p>在需要使用多个列作为条件进行查询时，使用多列索引比使用多个单列索引性能更好。例如下面的语句中，最好把 actor_id 和 film_id 设置为多列索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT film_id, actor_ id FROM sakila.film_actor</span><br><span class="line">WHERE actor_id &#x3D; 1 AND film_id &#x3D; 1;</span><br></pre></td></tr></table></figure>

<ul>
<li>索引列的顺序（最左匹配原则）</li>
</ul>
<p>让选择性最强的索引列放在前面，可以减少回表的搜索范围。</p>
<ul>
<li>索引下推</li>
</ul>
<p>Mysql 5.6引入索引下推，可以在索引遍历过程中，对索引包含的字段先做判断过滤掉不符合的记录，减少回表次数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name,tel from tuser where job&#x3D;&#39;HR&#39; and age&gt;18 and ismale&#x3D;0;</span><br></pre></td></tr></table></figure>

<ul>
<li>前缀索引</li>
</ul>
<p>对于 text 和 varchar 类型的列，使用前缀索引只索引某些部分字符关键字段。</p>
<p>eg: 用户邮箱字段建立索引，如：<a target="_blank" rel="noopener" href="http://www.123456.qq.com/">www.123456.qq.com</a> 前后字段都是无用字符，可使用substring()截取中间关键字符添加索引。</p>
<ul>
<li>覆盖索引</li>
</ul>
<p>索引包含所有需要查询的字段的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from itemCenter where size between 1 and 6；</span><br></pre></td></tr></table></figure>

<p>id是数据表主键，size索引上包含有这个值，不需要再去返回表中去查找id数据。</p>
<p>客户端执行SQL流程</p>
<p><img src="https://docimg2.docs.qq.com/image/3YAHfBUcIEe_1Je6F2ia2g?w=310&h=600" alt="img"></p>
<p>查询性能优化</p>
<p>使用explain分析select查询语句的执行计划，可以通过分析explain结果来优化查询语句。</p>
<p>使用方式： 在查询select语句前加explain关键字。</p>
<p><img src="https://docimg2.docs.qq.com/image/Md0GpIhsHls23f6YbL1fUw?w=817&h=124" alt="img"></p>
<p>explain输出信息的字段，分别的含义有：</p>
<ul>
<li>id: 包含一组数据，表示查询中执行select子语句或操作表的顺序；</li>
<li>select_type: 表示查询的类型， 常用的有 SIMPLE 简单查询，UNION 联合查询，                    SUBQUERY 子查询等。</li>
<li>table: 要查询的表</li>
<li>possible_keys: 可选择的索引，但实际不一定使用到</li>
<li>key: 实际使用到的索引</li>
<li>key_len: 表示索引使用的字节数，在索引不失精度的情况下越短越好</li>
<li>ref: 显示哪一列索引被使用了</li>
<li>rows: 扫描的行数</li>
<li>type: 对表的访问方式，表示mysql中找到所需行的方式，又称访问类型。</li>
</ul>
<p>​         type值常用的类型有：all, index, range, ref, eq_ref, const, system, null 从左到右性能         以此增加。</p>
<ul>
<li>Extra: 包含不适合在其他列中显示的信息。</li>
</ul>
<p>ps: 在进行索引优化时需要排除sql缓存影响。</p>
<p>优化数据访问</p>
<ol>
<li><p>只返回必要的列：最好不要使用 SELECT * 语句。</p>
</li>
<li><p>只返回必要的行：使用 LIMIT 语句来限制返回的数据。</p>
</li>
<li><p>缓存重复查询的数据。</p>
</li>
<li><p>使用索引来覆盖查询减少服务器扫描的行数。</p>
</li>
</ol>
<p>重构查询方式</p>
<p>切分大查询</p>
<p>如果一个大查询一次执行，可能锁住多条数据，耗尽系统资源，阻塞很多很小但很重要的查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM messages WHERE create &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH);  # 可使用limit进行分批删除</span><br></pre></td></tr></table></figure>

<p>分解大链接查询</p>
<p>拆分成单表查询，可以让缓存更高效，减少锁竞争，并且更加容易对数据库进行拆分同时对sql的执行效率也有所提高。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tag</span><br><span class="line">JOIN tag_post ON tag_post.tag_id&#x3D;tag.id</span><br><span class="line">JOIN post ON tag_post.post_id&#x3D;post.id</span><br><span class="line">WHERE tag.tag&#x3D;&#39;mysql&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tag WHERE tag&#x3D;&#39;mysql&#39;;</span><br><span class="line">SELECT * FROM tag_post WHERE tag_id&#x3D;1234;</span><br><span class="line">SELECT * FROM post WHERE post.id IN (123,456,567,9098,8904);</span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>1.全局配置</p>
<p>在settings里面配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;ATOMIC_REQUESTS&quot;: True, #全局开启事务，绑定的是http请求响应整个过程</span><br></pre></td></tr></table></figure>

<p>使得一个http请求对应的所有sql都放在一个事务中执行，是全局性的配置。</p>
<p>2.局部配置</p>
<p>（1）函数装饰器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.db import transaction</span><br><span class="line">@transaction.atomic</span><br></pre></td></tr></table></figure>

<p>（2）上下文管理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with transaction.atomic()</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/17/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94SQL/" data-id="ckmzn8px5001fj2tdcdbk8ohe" data-title="日常笔记——SQL" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/09/17/ML%E5%9B%9E%E5%BD%92/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          ML回归
        
      </div>
    </a>
  
  
    <a href="/2020/09/17/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">日常笔记——微信小程序</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Go/">Go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/idea/">idea</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/">nosql</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/07/EKL/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/04/06/Sentry/">Sentry</a>
          </li>
        
          <li>
            <a href="/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94k8s/">日常笔记——k8s</a>
          </li>
        
          <li>
            <a href="/2021/04/01/%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Python/">日常笔记——Python</a>
          </li>
        
          <li>
            <a href="/2021/03/25/%E6%9C%AC%E5%9C%B0%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7%E2%80%94%E2%80%94Coverage/">本地单元测试统计工具——Coverage</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Jimmy Guo<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>